Version 4
SHEET 1 1500 936
WIRE -608 32 -992 32
WIRE -320 32 -608 32
WIRE -96 32 -320 32
WIRE -1056 48 -1424 48
WIRE -928 64 -992 64
WIRE -320 64 -320 32
WIRE -96 64 -96 32
WIRE -928 80 -928 64
WIRE -32 80 -48 80
WIRE -992 96 -992 80
WIRE -1936 128 -1984 128
WIRE -1424 128 -1424 48
WIRE -1424 128 -1872 128
WIRE -32 128 -48 128
WIRE -608 144 -608 32
WIRE -1856 160 -1872 160
WIRE -928 176 -928 160
WIRE -320 176 -320 144
WIRE -96 176 -96 144
WIRE -96 176 -320 176
WIRE -1888 192 -1888 176
WIRE -96 192 -96 176
WIRE -2016 240 -2080 240
WIRE -2016 288 -2016 240
WIRE 224 288 208 288
WIRE 464 288 224 288
WIRE 544 288 464 288
WIRE 720 288 544 288
WIRE 1008 288 720 288
WIRE 1104 288 1008 288
WIRE 1264 288 1168 288
WIRE -1984 320 -1984 128
WIRE -1984 320 -2016 320
WIRE -1856 320 -1856 160
WIRE -1824 320 -1856 320
WIRE -1376 320 -1760 320
WIRE -608 320 -608 224
WIRE -608 320 -800 320
WIRE -864 336 -1312 336
WIRE 464 336 464 288
WIRE 544 336 544 288
WIRE -1696 352 -1760 352
WIRE -1024 352 -1312 352
WIRE -608 352 -800 352
WIRE -288 352 -608 352
WIRE 144 352 -208 352
WIRE -2112 368 -2272 368
WIRE -1936 368 -2016 368
WIRE -1776 384 -1776 368
WIRE -1328 384 -1328 368
WIRE 144 384 144 352
WIRE 720 384 720 288
WIRE 1008 384 1008 288
WIRE 1104 384 1008 384
WIRE 1264 384 1264 288
WIRE 1264 384 1168 384
WIRE -800 400 -800 368
WIRE 224 400 224 288
WIRE 224 400 192 400
WIRE -608 416 -608 352
WIRE -1696 432 -1696 352
WIRE 1008 432 1008 384
WIRE 1264 432 1264 384
WIRE -1936 448 -1936 368
WIRE 224 448 192 448
WIRE 464 448 464 400
WIRE 544 448 544 400
WIRE 1328 448 1312 448
WIRE 1328 496 1312 496
WIRE -1696 528 -1696 512
WIRE -1024 528 -1024 352
WIRE -1936 544 -1936 528
WIRE -1024 560 -1024 528
WIRE -608 560 -608 496
WIRE 144 560 144 464
WIRE 144 560 -608 560
WIRE 224 560 224 448
WIRE 224 560 144 560
WIRE 464 560 464 528
WIRE 464 560 224 560
WIRE 544 560 544 528
WIRE 544 560 464 560
WIRE 720 560 720 448
WIRE 720 560 544 560
WIRE 1008 560 1008 512
WIRE 1008 560 720 560
WIRE 1264 560 1264 512
WIRE 1264 560 1008 560
WIRE 1264 576 1264 560
WIRE -1024 656 -1024 640
FLAG -2080 240 AGND
FLAG -1936 544 AGND
FLAG -800 400 AGND
FLAG 1264 576 AGND
IOPIN 1264 576 BiDir
FLAG 1328 448 FB
IOPIN 1328 448 In
FLAG 208 288 COMP
IOPIN 208 288 BiDir
FLAG -96 192 AGND
FLAG -32 80 CS_P
IOPIN -32 80 In
FLAG -32 128 CS_N
IOPIN -32 128 In
FLAG -2272 368 PWM
IOPIN -2272 368 Out
FLAG -1328 384 AGND
FLAG -1024 528 DCL
FLAG -1024 656 AGND
FLAG -928 176 AGND
FLAG -992 96 AGND
FLAG -1776 384 AGND
FLAG -1696 528 AGND
FLAG 1328 496 VREF
IOPIN 1328 496 In
FLAG -1888 192 AGND
SYMBOL diffschmtbuf -800 272 M0
WINDOW 40 -130 -4 Left 2
SYMATTR SpiceLine2 Td={PROP_DLY}
SYMATTR InstName A1
SYMATTR SpiceLine Tau=1n Vt=0 Vh=1m
SYMBOL srflop -2064 416 R180
SYMATTR InstName A2
SYMATTR SpiceLine Tau=1n
SYMBOL voltage -1936 432 M0
SYMATTR InstName V1
SYMATTR Value PULSE(0 1 0 1n 1n 10n {1/Fsw})
SYMBOL g2 1264 416 M0
SYMATTR InstName G1
SYMATTR Value {gm}
SYMBOL diode 1168 368 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D1
SYMATTR Value Dpu
SYMBOL diode 1104 304 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value Dpd
SYMBOL res 992 416 R0
SYMATTR InstName R1
SYMATTR Value {Avol/gm}
SYMBOL cap 704 384 R0
SYMATTR InstName C1
SYMATTR Value {gm/(2*pi*Fpole*Avol)}
SYMBOL diode 528 336 R0
SYMATTR InstName D3
SYMATTR Value Dcl
SYMBOL voltage 544 432 R0
SYMATTR InstName V3
SYMATTR Value {VCOMP_H}
SYMBOL diode 448 400 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value Dcl
SYMBOL voltage 464 432 M0
SYMATTR InstName V4
SYMATTR Value {VCOMP_L}
SYMBOL e -96 48 M0
SYMATTR InstName E1
SYMATTR Value {CS_GAIN}
SYMBOL e 144 368 M0
SYMATTR InstName E2
SYMATTR Value {COMP_CTRL_GAIN}
SYMBOL voltage -192 352 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName V5
SYMATTR Value PULSE(0 {SLOPE_COMP/Fsw} 0 {1/Fsw-2n} 1n 1n {1/Fsw})
SYMBOL res -624 400 R0
SYMATTR InstName R2
SYMATTR Value 1G
SYMBOL or -1344 272 M0
SYMATTR InstName A3
SYMATTR SpiceLine Tau=1n
SYMBOL res -336 48 R0
SYMATTR InstName R3
SYMATTR Value 1G
SYMBOL voltage -1024 544 R0
SYMATTR InstName V6
SYMATTR Value PULSE(0 1 {DCYCLE_MAX/Fsw} 1n 1n 1n {1/Fsw-3n})
SYMBOL diffschmtbuf -992 -16 M0
WINDOW 40 -130 -4 Left 2
SYMATTR SpiceLine2 Td={ILIM_DLY}
SYMATTR InstName A4
SYMATTR SpiceLine Tau=1n Vt=0 Vh=1m
SYMBOL voltage -928 64 R0
SYMATTR InstName V7
SYMATTR Value {VILIM*CS_GAIN}
SYMBOL and -1792 272 M0
SYMATTR InstName A5
SYMBOL voltage -1696 416 R0
SYMATTR InstName V8
SYMATTR Value PULSE(0 1 {TLEB} 1n 1n {1/Fsw-TLEB-2n} {1/Fsw})
SYMBOL voltage -608 240 M180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
SYMATTR InstName V9
SYMATTR Value {CS_OFFSET}
SYMBOL or -1904 80 M0
SYMATTR InstName A6
SYMATTR SpiceLine Tau=1n
TEXT -1768 -80 Left 2 !.params Fsw=100k gm=2m Avol=100k Fpole=10 VCOMP_H=5 VCOMP_L=0 COMP_SOURCE_LIMIT=1m COMP_SINK_LIMIT=1m SLOPE_COMP=100k COMP_CTRL_GAIN=1 CS_GAIN=10 VILIM=0.05 ILIM_DLY=30n CS_OFFSET=0 DCYCLE_MAX=0.9 TLEB=50n PROP_DLY=10n
TEXT 360 80 Left 2 !.model Dpu D(Ron=1u Roff=100Meg Vfwd=0 Ilimit={COMP_SOURCE_LIMIT})
TEXT 360 104 Left 2 !.model Dpd D(Ron=1u Roff=100Meg Vfwd=0 Ilimit={COMP_SINK_LIMIT})
TEXT 360 128 Left 2 !.model Dcl D(Ron=1u Roff=1G Vfwd=0)
